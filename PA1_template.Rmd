---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---

```{r setup, cache=FALSE, include=FALSE}
library(knitr)
opts_chunk$set(echo=TRUE, fig.path='figure/')
```


Load some useful packages:
```{r load_packages, message=FALSE}
library(dplyr)
library(lubridate)
library(ggplot2)
library(scales)
```


## Loading and preprocessing the data
```{r load_data}
dataFile <- 'activity.csv'
activity <- read.csv(dataFile, 
                     colClasses=c("numeric", "POSIXct", "numeric"))
activity <- tbl_df(activity)
```

## What is mean total number of steps taken per day?
```{r total_steps}
activity_by_day <- activity %>% group_by(date)
by_day <- summarize(activity_by_day, total_steps=sum(steps))
```
```{r echo=FALSE}
# summarize(activity_by_day, mean(steps))
# activity_by_day <- mutate(activity_by_day,
#                           total_steps=sum(steps),
#                           mean_steps = mean(steps),
#                           median_steps = median(steps))
```

The experiment was conducted for `r tally(by_day)` days
(from `r min(by_day$date)` to `r max(by_day$date)`).

1. The total number of steps taken per day is
```{r}
by_day$total_steps
```

2. The histogram of the total number of steps taken each day is as follows:
```{r histogram_total_steps, fig.height=4}
hist(by_day$total_steps, breaks=10,
     main="Total number of steps taken each day", xlab="Total steps")
```

3. The mean of the total number of steps taken per day is
```{r mean_total_steps}
mean_total_steps <- mean(by_day$total_steps, na.rm=TRUE)
mean_total_steps
```

The median of the total number of steps taken per day is
```{r median_total_steps}
median_total_steps <- median(by_day$total_steps, na.rm=TRUE)
median_total_steps
```

[//]: # (**zero** for all `r sum(!is.na(by_day$total_steps))` days without
missing values. Indeed, there are `r sum(by_day$median_steps != 0, na.rm=TRUE)`
days where the median is not zero.)

## What is the average daily activity pattern?
```{r average_daily_activity}
activity_by_interval <- activity %>% group_by(interval)
by_interval <- summarize(activity_by_interval,
                         avg_steps=mean(steps, na.rm=TRUE))
by_interval <- mutate(by_interval, time=fast_strptime(sprintf("%04d", interval),
                                                      "%H%M"))
# with(by_interval, plot(time, avg_steps, type='l', col='blue', lwd=3,
#                        main="Number of steps taken, averaged across all days",
#                        xlab='5-min interval',
#                        ylab = "Average number of steps"))
ggplot(data=by_interval, aes(time, avg_steps)) + 
  geom_line(color="#000099", size=1) +
  scale_x_datetime(breaks=date_breaks("120 min"), labels=date_format("%H:%M")) +
  ggtitle("Number of steps taken, averaged across all days") +
  ylab("Average number of steps") + xlab("5-min interval")
```

The 5-min interval with the maximum number of steps, on average across all the
days in the dataset, is
```{r max_steps}
max_steps <- with(by_interval, by_interval[max(avg_steps) == avg_steps, 1])
max_steps
```
```{r echo=FALSE}
# max_steps <- by_interval %>% filter(max(avg_steps) == avg_steps) %>%
#   select(interval)
#  max_steps
```
which corresponds to the 5-min interval starting at
`r max_steps %/% 100`:`r max_steps %% 100`.


## Imputing missing values


## Are there differences in activity patterns between weekdays and weekends?
